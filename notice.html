<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>অনলাইন নোটিশ বোর্ড ২০২৬ | কালাইয়া বোর্ড সপ্রাবি</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #f8f9fa; }
        
        .navbar { background: #006A4E; }
        .notice-header { background: #fff; padding: 30px 0; border-bottom: 3px solid #006A4E; margin-bottom: 30px; }
        .header-title { color: #006A4E; font-weight: 700; border-left: 5px solid #FFB800; padding-left: 15px; }

        /* Table Design */
        .table-container { background: #fff; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
        .table thead { background: #f1f3f5; color: #333; }
        .table th { font-weight: 700; padding: 15px; border-bottom: 2px solid #dee2e6; }
        .table td { padding: 12px 15px; vertical-align: middle; border-bottom: 1px solid #eee; }

        .notice-title-link { color: #333; text-decoration: none; font-weight: 500; transition: 0.3s; }
        .notice-title-link:hover { color: #006A4E; }

        .pdf-icon { color: #d32f2f; font-size: 1.5rem; transition: 0.3s; }
        .pdf-icon:hover { transform: scale(1.2); }

        .btn-action { color: #006A4E; font-weight: 600; text-decoration: none; border: 1px solid #006A4E; padding: 4px 12px; border-radius: 4px; transition: 0.3s; font-size: 14px; }
        .btn-action:hover { background: #006A4E; color: #fff; }

        .urgent-tag { background: #ff5252; color: white; font-size: 11px; padding: 2px 8px; border-radius: 4px; margin-left: 5px; }

        /* Preview Modal */
        .modal-xl { max-width: 90%; }
        .modal-content { border-radius: 15px; border: none; }
        .modal-header { background: #006A4E; color: white; border-radius: 15px 15px 0 0; }
        #pdf-iframe { width: 100%; height: 80vh; border: none; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">
            <img src="images/govt.png" width="30" class="me-2" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/8/84/Government_Seal_of_Bangladesh.svg'"> 
            কালাইয়া বোর্ড সপ্রাবি
        </a>
    </div>
</nav>

<div class="notice-header">
    <div class="container">
        <h2 class="header-title">নোটিশ বোর্ড</h2>
    </div>
</div>

<div class="container mb-5">
    <div class="table-container animate__animated animate__fadeIn">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th width="5%">নং</th>
                        <th width="50%">শিরোনাম</th>
                        <th width="10%" class="text-center">ফাইল সমূহ</th>
                        <th width="15%">প্রকাশের তারিখ</th>
                        <th width="10%" class="text-center">কার্যকলাপ</th>
                    </tr>
                </thead>
                <tbody id="notice-table-body">
                    <tr>
                        <td colspan="5" class="text-center py-5">
                            <div class="spinner-border text-success" role="status"></div>
                            <p class="mt-2">নোটিশ লোড হচ্ছে...</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="modalTitle">নোটিশ প্রিভিউ</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <iframe id="pdf-iframe" src=""></iframe>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // আপনার Google Sheets CSV লিঙ্ক
    const csv_url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTWc0HbimA9ddlA7yP3KG4ahQosskjgdihVtL3EJIebhKdiF0_N10dkOEp_9Q66T7cX1JqHZXiwbwbN/pub?gid=0&single=true&output=csv";

    async function fetchNotices() {
        try {
            const response = await fetch(csv_url);
            const data = await response.text();
            const rows = data.split('\n').slice(1);
            let tableHtml = '';

            rows.forEach((row, index) => {
                const col = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); // Comma separation logic for titles with commas
                if (col.length >= 3) {
                    const date = col[0].trim();
                    const title = col[1].replace(/"/g, "").trim();
                    const driveLink = col[2].trim();
                    const isUrgent = col[3] && col[3].toLowerCase().includes('yes');

                    // Google Drive Link Processing
                    let fileID = driveLink.match(/[-\w]{25,}/);
                    let previewLink = driveLink;
                    let downloadLink = driveLink;

                    if(fileID) {
                        previewLink = `https://drive.google.com/file/d/${fileID[0]}/preview`;
                        downloadLink = `https://drive.google.com/uc?export=download&id=${fileID[0]}`;
                    }

                    tableHtml += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <a href="javascript:void(0)" onclick="viewNotice('${title}', '${previewLink}')" class="notice-title-link">
                                ${title}
                            </a>
                            ${isUrgent ? '<span class="urgent-tag">জরুরি</span>' : ''}
                        </td>
                        <td class="text-center">
                            <a href="${downloadLink}" target="_blank" title="ডাউনলোড করুন">
                                <i class="fas fa-file-pdf pdf-icon"></i>
                            </a>
                        </td>
                        <td>${date}</td>
                        <td class="text-center">
                            <a href="javascript:void(0)" onclick="viewNotice('${title}', '${previewLink}')" class="btn-action">দেখুন</a>
                        </td>
                    </tr>`;
                }
            });

            document.getElementById('notice-table-body').innerHTML = tableHtml || "<tr><td colspan='5' class='text-center'>কোনো নোটিশ পাওয়া যায়নি।</td></tr>";
        } catch (error) {
            document.getElementById('notice-table-body').innerHTML = "<tr><td colspan='5' class='text-center text-danger'>ডেটা লোড করতে সমস্যা হয়েছে।</td></tr>";
        }
    }

    function viewNotice(title, link) {
        document.getElementById('modalTitle').innerText = title;
        document.getElementById('pdf-iframe').src = link;
        var myModal = new Bootstrap.Modal(document.getElementById('previewModal'));
        myModal.show();
    }

    // Modal বন্ধ হলে iframe খালি করা (যাতে সাউন্ড বা লোডিং বন্ধ থাকে)
    document.getElementById('previewModal').addEventListener('hidden.bs.modal', function () {
        document.getElementById('pdf-iframe').src = "";
    });

    fetchNotices();
</script>

</body>
</html>
